# 并发编程的挑战

## 上下文切换

CPU通过时间片分配算法来循环执行任务，当前任务执行一个时间片后会切换到下一个任务。

Tips：多线程不一定快，因为线程有创建和上下文切换的开销。

### 如何减少上下文切换
无锁并发编程、CAS算法、使用最少线程和使用协程

* 无锁并发编程
  多线程竞争锁时，会引起上下文切换，可以使用锁分段技术优化
* CAS算法
  Atomic包使用CAS算法更新数据，而不需要加锁
* 使用最少线程
  避免创建不需要的线程，线程池复用线程
* 使用协程
  单线程里实现多任务的调度，并在单线程里维持多个任务的切换

### 避免死锁

* 避免一个线程同时获取多个锁
* 避免一个线程在锁内同时占用多个资源，尽量保证每个所只占用一个资源
* 尝试使用定时锁，使用lock.tryLock(timeout)来替代使用内部锁机制
* 对于数据库锁，加锁和解锁必须在一个数据库连接里，否则会出现解锁失败的情况
  
