# 系统启动流程

* init
* zygote
* system_server
* Launcher

## init进程总结
讲到这，总结起来init进程主要做了三件事：
1.创建一些文件夹并挂载设备
2.初始化和启动属性服务
3.解析init.rc配置文件并启动zygote进程

## Zygote进程

### Zygote简介

在Android系统中，DVM(Dalvik虚拟机)、应用程序进程以及运行系统的关键服务的SystemServer进程都是由Zygote进程来创建的，我们也将它称为孵化器。它通过fock(复制进程)的形式来创建应用程序进程和SystemServer进程，由于Zygote进程在启动时会创建DVM，因此通过fock而创建的应用程序进程和SystemServer进程可以在内部获取一个DVM的实例拷贝。

### Zygote的Java框架层
* registerZygoteSocket
创建LocalServerSocket，也就是服务端的Socket。等待ActivityManagerService请求Zygote进程来创建新的应用程序进程。
* 启动SystemServer进程
* runSelectLoop
无限循环用来等待ActivityManagerService请求Zygote进程创建新的应用程序进程。

### Zygote进程总结
Zygote启动流程就讲到这，Zygote进程共做了如下几件事：
1.创建AppRuntime并调用其start方法，启动Zygote进程。
2.创建DVM并为DVM注册JNI.
3.通过JNI调用ZygoteInit的main函数进入Zygote的Java框架层。
4.通过registerZygoteSocket函数创建服务端Socket，并通过runSelectLoop函数等待ActivityManagerService的请求来创建新的应用程序进程。
5.启动SystemServer进程。

## SyetemServer进程

官方把系统服务分为了三种类型，分别是引导服务、核心服务和其他服务

4.总结SyetemServer进程

SyetemServer在启动时做了如下工作：

1.启动Binder线程池，这样就可以与其他进程进行通信。
2.创建SystemServiceManager用于对系统的服务进行创建、启动和生命周期管理。
3.启动各种系统服务。

## Launcher的启动流程

### Launcher概述
Android系统启动的最后一步是启动一个Home应用程序，这个应用程序用来显示系统中已经安装的应用程序，这个Home应用程序就叫做Launcher。应用程序Launcher在启动过程中会请求PackageManagerService返回系统中已经安装的应用程序的信息，并将这些信息封装成一个快捷图标列表显示在系统屏幕上，这样用户可以通过点击这些快捷图标来启动相应的应用程序。

### Launcher启动流程

SystemServer进程在启动的过程中会启动PackageManagerService，PackageManagerService启动后会将系统中的应用程序安装完成。在此前已经启动的ActivityManagerService会将Launcher启动起来。


## Android系统启动流程
我们就可以得出Android系统启动流程，如下所示。
1. 启动电源以及系统启动
当电源按下时引导芯片代码开始从预定义的地方（固化在ROM）开始执行。加载引导程序Bootloader到RAM，然后执行。
2. 引导程序BootLoader
引导程序BootLoader是在Android操作系统开始运行前的一个小程序，它的主要作用是把系统OS拉起来并运行。
3. Linux内核启动
内核启动时，设置缓存、被保护存储器、计划列表、加载驱动。当内核完成系统设置，它首先在系统文件中寻找init.rc文件，并启动init进程。
4. init进程启动
初始化和启动属性服务，并且启动Zygote进程。
5. Zygote进程启动
创建JavaVM并为JavaVM注册JNI，创建服务端Socket，启动SystemServer进程。
6. SystemServer进程启动
启动Binder线程池和SystemServiceManager，并且启动各种系统服务。
7. Launcher启动
被SystemServer进程启动的ActivityManagerService会启动Launcher，Launcher启动后会将已安装应用的快捷图标显示到界面上。
