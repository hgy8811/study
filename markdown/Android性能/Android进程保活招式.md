# Android进程保活

```
Android进程保活包括两个层面：

1. 提供进程优先级，降低进程被杀死的概率

2. 在进程被杀死后，进行拉活
```

## 进程的优先级
根据进程的重要性，被划分为5级：

1. 前台进程 (Foreground process)
2. 可见进程 (Visible process)
3. 服务进程 (Service process)
4. 后台进程 (Background process) 对不可见的Activity的进程（已调用onStop()方法）
5. 空进程 (Empty process)    保留的唯一目的是用作缓存

## 进程的回收策略
主要依靠LowMemorykiller来完成，是一种根据OOM_ADJ阈值级别触发相应力度的内存回收的机制。
在 Lowmemorykiller 回收内存时会根据进程的级别优先杀死 OOM_ADJ 比较大的进程，对于优先级相同的进程则进一步受到进程所占内存和进程存活时间的影响。

Tips:减少进程被杀死概率无非就是想办法提高进程优先级，减少进程在内存不足等情况下被杀死的概率。

## 提升进程优先级的方案
1. 利用 Activity 提升权限 [针对锁屏]
2. 利用 Notification 提升权限

## 进程死后拉活的方案
1. 利用系统广播拉活 [开机、网络变化、屏幕亮灭、锁屏解锁]
缺点：<1> 广播接收器被管理软件、系统软件通过“自启管理”等功能禁用的场景无法接收到广播，从而无法自启。
     <2> 系统广播事件不可控，只能保证发生事件时拉活进程，但无法保证进程挂掉后立即拉活。

2. 利用第三方应用广播拉活
通过反编译第三方 Top 应用，如：手机QQ、微信、支付宝，找出它们外发的广播，在应用中进行监听，这样当这些应用发出广播时，就会将我们的应用拉活。

缺点：变动较大，不靠谱

3. 利用系统Service机制拉活

将 Service 设置为 START_STICKY，利用系统机制在 Service 挂掉后自动拉活。

Tips： 存在不再拉起的情况

4. 利用Native进程拉活

利用 Linux 中的 fork 机制创建 Native 进程，在 Native 进程中监控主进程的存活，当主进程挂掉后，在 Native 进程中立即对主进程进行拉活。

缺点： 主要适用于 Android5.0 以下版本手机 5.0以上不能保证

5. 利用 JobScheduler 机制拉活

Tips:适用于 Android5.0 以上版本手机,仅在小米手机可能会出现有时无法拉活的问题

6. 利用账号同步机制拉活
Android 系统的账号同步机制会定期进行同步账号，该方案目的在于利用同步机制进行进程的拉活。

Tips:该方案需要在 AndroidManifest 中定义账号授权与同步服务。
     最新 Android 版本（Android N）中系统好像对账户同步这里做了变动，该方法不再有效。

## 其他有效拉活方案
还有其他一些系统拉活措施可以使用，但在使用时需要用户授权，用户感知比较强烈。
1. 利用系统通知管理权限进行拉活
2. 利用辅助功能拉活，将应用加入厂商或管理软件白名单。

总结：强制保活是不科学的，该被回收的时候还是被回收的好。提高优先级，降低内存消耗。

## 备注引用
** [参考文章 - Android进程保活招式大全](http://dev.qq.com/topic/57ac4a0ea374c75371c08ce8) **
